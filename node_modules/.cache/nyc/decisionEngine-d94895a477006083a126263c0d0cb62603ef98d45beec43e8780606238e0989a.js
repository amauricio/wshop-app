function cov_2e4e5qip2x(){var path="/vagrant/continuum/core/src/modules/evaluation/middlewares/chl/v1/rules/fn/decisionEngine.js";var hash="37d628d1c2cb48f3aa72a525448edae0126ecd8a";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/vagrant/continuum/core/src/modules/evaluation/middlewares/chl/v1/rules/fn/decisionEngine.js",statementMap:{"0":{start:{line:1,column:32},end:{line:1,column:113}},"1":{start:{line:2,column:23},end:{line:2,column:90}},"2":{start:{line:4,column:28},end:{line:13,column:2}},"3":{start:{line:4,column:92},end:{line:13,column:1}},"4":{start:{line:15,column:27},end:{line:33,column:1}},"5":{start:{line:16,column:2},end:{line:32,column:3}},"6":{start:{line:17,column:33},end:{line:17,column:111}},"7":{start:{line:18,column:36},end:{line:18,column:48}},"8":{start:{line:19,column:36},end:{line:25,column:6}},"9":{start:{line:27,column:4},end:{line:29,column:5}},"10":{start:{line:28,column:6},end:{line:28,column:48}},"11":{start:{line:31,column:4},end:{line:31,column:41}},"12":{start:{line:35,column:38},end:{line:47,column:4}},"13":{start:{line:36,column:2},end:{line:47,column:4}},"14":{start:{line:42,column:4},end:{line:44,column:5}},"15":{start:{line:43,column:6},end:{line:43,column:63}},"16":{start:{line:46,column:4},end:{line:46,column:29}},"17":{start:{line:48,column:57},end:{line:57,column:49}},"18":{start:{line:52,column:2},end:{line:57,column:49}},"19":{start:{line:59,column:24},end:{line:80,column:1}},"20":{start:{line:60,column:27},end:{line:60,column:31}},"21":{start:{line:62,column:30},end:{line:68,column:3}},"22":{start:{line:63,column:4},end:{line:67,column:6}},"23":{start:{line:70,column:52},end:{line:70,column:112}},"24":{start:{line:72,column:2},end:{line:79,column:3}},"25":{start:{line:73,column:44},end:{line:73,column:112}},"26":{start:{line:75,column:36},end:{line:75,column:118}},"27":{start:{line:77,column:4},end:{line:77,column:95}},"28":{start:{line:78,column:4},end:{line:78,column:35}},"29":{start:{line:82,column:0},end:{line:88,column:2}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:4,column:28},end:{line:4,column:29}},loc:{start:{line:4,column:92},end:{line:13,column:1}},line:4},"1":{name:"(anonymous_1)",decl:{start:{line:15,column:27},end:{line:15,column:28}},loc:{start:{line:15,column:110},end:{line:33,column:1}},line:15},"2":{name:"(anonymous_2)",decl:{start:{line:35,column:38},end:{line:35,column:39}},loc:{start:{line:36,column:2},end:{line:47,column:4}},line:36},"3":{name:"(anonymous_3)",decl:{start:{line:41,column:10},end:{line:41,column:11}},loc:{start:{line:41,column:44},end:{line:47,column:3}},line:41},"4":{name:"(anonymous_4)",decl:{start:{line:48,column:57},end:{line:48,column:58}},loc:{start:{line:52,column:2},end:{line:57,column:49}},line:52},"5":{name:"(anonymous_5)",decl:{start:{line:59,column:24},end:{line:59,column:25}},loc:{start:{line:59,column:57},end:{line:80,column:1}},line:59},"6":{name:"(anonymous_6)",decl:{start:{line:62,column:30},end:{line:62,column:31}},loc:{start:{line:62,column:40},end:{line:68,column:3}},line:62}},branchMap:{"0":{loc:{start:{line:10,column:9},end:{line:10,column:59}},type:"cond-expr",locations:[{start:{line:10,column:33},end:{line:10,column:54}},{start:{line:10,column:57},end:{line:10,column:59}}],line:10},"1":{loc:{start:{line:12,column:9},end:{line:12,column:59}},type:"cond-expr",locations:[{start:{line:12,column:33},end:{line:12,column:54}},{start:{line:12,column:57},end:{line:12,column:59}}],line:12},"2":{loc:{start:{line:27,column:4},end:{line:29,column:5}},type:"if",locations:[{start:{line:27,column:4},end:{line:29,column:5}},{start:{line:27,column:4},end:{line:29,column:5}}],line:27},"3":{loc:{start:{line:42,column:4},end:{line:44,column:5}},type:"if",locations:[{start:{line:42,column:4},end:{line:44,column:5}},{start:{line:42,column:4},end:{line:44,column:5}}],line:42},"4":{loc:{start:{line:52,column:2},end:{line:57,column:49}},type:"binary-expr",locations:[{start:{line:52,column:2},end:{line:52,column:39}},{start:{line:53,column:2},end:{line:53,column:49}},{start:{line:54,column:2},end:{line:54,column:51}},{start:{line:55,column:2},end:{line:55,column:61}},{start:{line:56,column:2},end:{line:56,column:48}},{start:{line:57,column:2},end:{line:57,column:49}}],line:52},"5":{loc:{start:{line:72,column:2},end:{line:79,column:3}},type:"if",locations:[{start:{line:72,column:2},end:{line:79,column:3}},{start:{line:72,column:2},end:{line:79,column:3}}],line:72}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0,0,0,0,0],"5":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"37d628d1c2cb48f3aa72a525448edae0126ecd8a"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_2e4e5qip2x=function(){return actualCoverage;};}return actualCoverage;}cov_2e4e5qip2x();const formatAmicarsEvaluation=(cov_2e4e5qip2x().s[0]++,require('modules/evaluation/middlewares/chl/v1/rules/fn/formatAmicarsEvaluation'));const{getEquifax}=(cov_2e4e5qip2x().s[1]++,require('modules/evaluation/middlewares/chl/v1/equifax/getEquifax'));cov_2e4e5qip2x().s[2]++;const prepareCustomerData=(AmicarsEvaluationRecord,equifaxResponse,customerRequest)=>{cov_2e4e5qip2x().f[0]++;cov_2e4e5qip2x().s[3]++;return{identificationTypeId:1,identificationValue:AmicarsEvaluationRecord.identifierValue,name:AmicarsEvaluationRecord.name,lastName:AmicarsEvaluationRecord.fatherLastName,motherLastName:AmicarsEvaluationRecord.motherLastName,email:customerRequest.email?(cov_2e4e5qip2x().b[0][0]++,customerRequest.email):(cov_2e4e5qip2x().b[0][1]++,''),dob:equifaxResponse.equifaxReportedDob,phone:customerRequest.phone?(cov_2e4e5qip2x().b[1][0]++,customerRequest.phone):(cov_2e4e5qip2x().b[1][1]++,'')};};cov_2e4e5qip2x().s[4]++;const persistRequestData=async(commonModels,AmicarsEvaluationRecord,equifaxResponse,customerRequest)=>{cov_2e4e5qip2x().f[1]++;cov_2e4e5qip2x().s[5]++;try{const preparedCustomerData=(cov_2e4e5qip2x().s[6]++,prepareCustomerData(AmicarsEvaluationRecord,equifaxResponse,customerRequest));const{CustomerDataPgModel}=(cov_2e4e5qip2x().s[7]++,commonModels);const[CustomerData,created]=(cov_2e4e5qip2x().s[8]++,await CustomerDataPgModel.findOrCreate({where:{identificationTypeId:1,identificationValue:AmicarsEvaluationRecord.identifierValue},defaults:preparedCustomerData}));cov_2e4e5qip2x().s[9]++;if(!created){cov_2e4e5qip2x().b[2][0]++;cov_2e4e5qip2x().s[10]++;CustomerData.update(preparedCustomerData);}else{cov_2e4e5qip2x().b[2][1]++;}}catch(err){cov_2e4e5qip2x().s[11]++;console.log(`ERROR: ${err.message}`);}};cov_2e4e5qip2x().s[12]++;const createAmicarsEvaluationRecord=async(commonModels,AmicarsEvaluationRecord)=>{cov_2e4e5qip2x().f[2]++;cov_2e4e5qip2x().s[13]++;return commonModels.AmicarsEvaluationPgModel.findOrCreate({where:{identifierValue:AmicarsEvaluationRecord.identifierValue},defaults:AmicarsEvaluationRecord}).then(([AmicarsEvaluation,created])=>{cov_2e4e5qip2x().f[3]++;cov_2e4e5qip2x().s[14]++;if(!created){cov_2e4e5qip2x().b[3][0]++;cov_2e4e5qip2x().s[15]++;return AmicarsEvaluation.update(AmicarsEvaluationRecord);}else{cov_2e4e5qip2x().b[3][1]++;}cov_2e4e5qip2x().s[16]++;return AmicarsEvaluation;});};cov_2e4e5qip2x().s[17]++;const evaluateEquifaxAndCustomerDataEligibilityForLoan=amicarsEvaluation=>{cov_2e4e5qip2x().f[4]++;cov_2e4e5qip2x().s[18]++;return(/*
   * Evaluate using Decision Engine data
   */(cov_2e4e5qip2x().b[4][0]++,amicarsEvaluation.ageWithinParameters)&&(cov_2e4e5qip2x().b[4][1]++,amicarsEvaluation.minimumIncomeWithinParameters)&&(cov_2e4e5qip2x().b[4][2]++,amicarsEvaluation.financingAmountWithinParameters)&&(cov_2e4e5qip2x().b[4][3]++,amicarsEvaluation.financingAmountPercentageWithinParameters)&&(cov_2e4e5qip2x().b[4][4]++,amicarsEvaluation.equifaxScoreWithinParameters)&&(cov_2e4e5qip2x().b[4][5]++,amicarsEvaluation.delinquenciesWithinParameters));};cov_2e4e5qip2x().s[19]++;const evaluateRequest=async(deps,customerRequest)=>{cov_2e4e5qip2x().f[5]++;const{commonModels}=(cov_2e4e5qip2x().s[20]++,deps);cov_2e4e5qip2x().s[21]++;const buildPayloadEquifax=body=>{cov_2e4e5qip2x().f[6]++;cov_2e4e5qip2x().s[22]++;return{identifierType:customerRequest.identifierType,identifierValue:customerRequest.identifierValue,income:customerRequest.income};};const{result:equifaxHttpObj,error,cached}=(cov_2e4e5qip2x().s[23]++,await getEquifax(deps,buildPayloadEquifax(customerRequest)));cov_2e4e5qip2x().s[24]++;if(!error){cov_2e4e5qip2x().b[5][0]++;const preparedAmicarsEvaluationRecord=(cov_2e4e5qip2x().s[25]++,await formatAmicarsEvaluation(deps,equifaxHttpObj,customerRequest));const AmicarsEvaluationRecord=(cov_2e4e5qip2x().s[26]++,await createAmicarsEvaluationRecord(commonModels,preparedAmicarsEvaluationRecord));cov_2e4e5qip2x().s[27]++;persistRequestData(commonModels,AmicarsEvaluationRecord,equifaxHttpObj,customerRequest);cov_2e4e5qip2x().s[28]++;return AmicarsEvaluationRecord;}else{cov_2e4e5qip2x().b[5][1]++;}};cov_2e4e5qip2x().s[29]++;module.exports={evaluateRequest,// Validations/Evaluations
evaluateEquifaxAndCustomerDataEligibilityForLoan,createAmicarsEvaluationRecord};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRlY2lzaW9uRW5naW5lLmpzIl0sIm5hbWVzIjpbImZvcm1hdEFtaWNhcnNFdmFsdWF0aW9uIiwicmVxdWlyZSIsImdldEVxdWlmYXgiLCJwcmVwYXJlQ3VzdG9tZXJEYXRhIiwiQW1pY2Fyc0V2YWx1YXRpb25SZWNvcmQiLCJlcXVpZmF4UmVzcG9uc2UiLCJjdXN0b21lclJlcXVlc3QiLCJpZGVudGlmaWNhdGlvblR5cGVJZCIsImlkZW50aWZpY2F0aW9uVmFsdWUiLCJpZGVudGlmaWVyVmFsdWUiLCJuYW1lIiwibGFzdE5hbWUiLCJmYXRoZXJMYXN0TmFtZSIsIm1vdGhlckxhc3ROYW1lIiwiZW1haWwiLCJkb2IiLCJlcXVpZmF4UmVwb3J0ZWREb2IiLCJwaG9uZSIsInBlcnNpc3RSZXF1ZXN0RGF0YSIsImNvbW1vbk1vZGVscyIsInByZXBhcmVkQ3VzdG9tZXJEYXRhIiwiQ3VzdG9tZXJEYXRhUGdNb2RlbCIsIkN1c3RvbWVyRGF0YSIsImNyZWF0ZWQiLCJmaW5kT3JDcmVhdGUiLCJ3aGVyZSIsImRlZmF1bHRzIiwidXBkYXRlIiwiZXJyIiwiY29uc29sZSIsImxvZyIsIm1lc3NhZ2UiLCJjcmVhdGVBbWljYXJzRXZhbHVhdGlvblJlY29yZCIsIkFtaWNhcnNFdmFsdWF0aW9uUGdNb2RlbCIsInRoZW4iLCJBbWljYXJzRXZhbHVhdGlvbiIsImV2YWx1YXRlRXF1aWZheEFuZEN1c3RvbWVyRGF0YUVsaWdpYmlsaXR5Rm9yTG9hbiIsImFtaWNhcnNFdmFsdWF0aW9uIiwiYWdlV2l0aGluUGFyYW1ldGVycyIsIm1pbmltdW1JbmNvbWVXaXRoaW5QYXJhbWV0ZXJzIiwiZmluYW5jaW5nQW1vdW50V2l0aGluUGFyYW1ldGVycyIsImZpbmFuY2luZ0Ftb3VudFBlcmNlbnRhZ2VXaXRoaW5QYXJhbWV0ZXJzIiwiZXF1aWZheFNjb3JlV2l0aGluUGFyYW1ldGVycyIsImRlbGlucXVlbmNpZXNXaXRoaW5QYXJhbWV0ZXJzIiwiZXZhbHVhdGVSZXF1ZXN0IiwiZGVwcyIsImJ1aWxkUGF5bG9hZEVxdWlmYXgiLCJib2R5IiwiaWRlbnRpZmllclR5cGUiLCJpbmNvbWUiLCJyZXN1bHQiLCJlcXVpZmF4SHR0cE9iaiIsImVycm9yIiwiY2FjaGVkIiwicHJlcGFyZWRBbWljYXJzRXZhbHVhdGlvblJlY29yZCIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiJvOEpBZVk7MkZBZlosS0FBTUEsQ0FBQUEsdUJBQXVCLDBCQUFHQyxPQUFPLENBQUMsd0VBQUQsQ0FBVixDQUE3QixDQUNBLEtBQU0sQ0FBRUMsVUFBRiwyQkFBaUJELE9BQU8sQ0FBQywwREFBRCxDQUF4QixDQUFOLEMsd0JBRUEsS0FBTUUsQ0FBQUEsbUJBQW1CLENBQUcsQ0FBQ0MsdUJBQUQsQ0FBMEJDLGVBQTFCLENBQTJDQyxlQUEzQyxHQUFnRSx3REFDMUZDLG9CQUFvQixDQUFFLENBRG9FLENBRTFGQyxtQkFBbUIsQ0FBRUosdUJBQXVCLENBQUNLLGVBRjZDLENBRzFGQyxJQUFJLENBQUVOLHVCQUF1QixDQUFDTSxJQUg0RCxDQUkxRkMsUUFBUSxDQUFFUCx1QkFBdUIsQ0FBQ1EsY0FKd0QsQ0FLMUZDLGNBQWMsQ0FBRVQsdUJBQXVCLENBQUNTLGNBTGtELENBTTFGQyxLQUFLLENBQUVSLGVBQWUsQ0FBQ1EsS0FBaEIsNkJBQXdCUixlQUFlLENBQUNRLEtBQXhDLDhCQUFnRCxFQUFoRCxDQU5tRixDQU8xRkMsR0FBRyxDQUFFVixlQUFlLENBQUNXLGtCQVBxRSxDQVExRkMsS0FBSyxDQUFFWCxlQUFlLENBQUNXLEtBQWhCLDZCQUF3QlgsZUFBZSxDQUFDVyxLQUF4Qyw4QkFBZ0QsRUFBaEQsQ0FSbUYsRUFTM0YsQ0FURCxDLHdCQVdBLEtBQU1DLENBQUFBLGtCQUFrQixDQUFHLE1BQU9DLFlBQVAsQ0FBcUJmLHVCQUFyQixDQUE4Q0MsZUFBOUMsQ0FBK0RDLGVBQS9ELEdBQW1GLGlEQUM1RyxHQUFJLENBQ0YsS0FBTWMsQ0FBQUEsb0JBQW9CLDBCQUFHakIsbUJBQW1CLENBQUNDLHVCQUFELENB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QXdDK0MsY0FBeEMsQ0FBd0Q3QyxlQUF4RCxDQUFsQixDQUxVLHlCQU1WLE1BQU9GLENBQUFBLHVCQUFQLENBQ0QsQ0FQRCxpQ0FRRCxDQXJCRCxDLHlCQXVCQW1ELE1BQU0sQ0FBQ0MsT0FBUCxDQUFpQixDQUNmWixlQURlLENBR2Y7QUFDQVIsZ0RBSmUsQ0FLZkosNkJBTGUsQ0FBakIiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBmb3JtYXRBbWljYXJzRXZhbHVhdGlvbiA9IHJlcXVpcmUoJ21vZHVsZXMvZXZhbHVhdGlvbi9taWRkbGV3YXJlcy9jaGwvdjEvcnVsZXMvZm4vZm9ybWF0QW1pY2Fyc0V2YWx1YXRpb24nKTtcclxuY29uc3QgeyBnZXRFcXVpZmF4IH0gPSByZXF1aXJlKCdtb2R1bGVzL2V2YWx1YXRpb24vbWlkZGxld2FyZXMvY2hsL3YxL2VxdWlmYXgvZ2V0RXF1aWZheCcpO1xyXG5cclxuY29uc3QgcHJlcGFyZUN1c3RvbWVyRGF0YSA9IChBbWljYXJzRXZhbHVhdGlvblJlY29yZCwgZXF1aWZheFJlc3BvbnNlLCBjdXN0b21lclJlcXVlc3QpID0+ICh7XHJcbiAgaWRlbnRpZmljYXRpb25UeXBlSWQ6IDEsXHJcbiAgaWRlbnRpZmljYXRpb25WYWx1ZTogQW1pY2Fyc0V2YWx1YXRpb25SZWNvcmQuaWRlbnRpZmllclZhbHVlLFxyXG4gIG5hbWU6IEFtaWNhcnNFdmFsdWF0aW9uUmVjb3JkLm5hbWUsXHJcbiAgbGFzdE5hbWU6IEFtaWNhcnNFdmFsdWF0aW9uUmVjb3JkLmZhdGhlckxhc3ROYW1lLFxyXG4gIG1vdGhlckxhc3ROYW1lOiBBbWljYXJzRXZhbHVhdGlvblJlY29yZC5tb3RoZXJMYXN0TmFtZSxcclxuICBlbWFpbDogY3VzdG9tZXJSZXF1ZXN0LmVtYWlsID8gY3VzdG9tZXJSZXF1ZXN0LmVtYWlsIDogJycsXHJcbiAgZG9iOiBlcXVpZmF4UmVzcG9uc2UuZXF1aWZheFJlcG9ydGVkRG9iLFxyXG4gIHBob25lOiBjdXN0b21lclJlcXVlc3QucGhvbmUgPyBjdXN0b21lclJlcXVlc3QucGhvbmUgOiAnJyxcclxufSk7XHJcblxyXG5jb25zdCBwZXJzaXN0UmVxdWVzdERhdGEgPSBhc3luYyAoY29tbW9uTW9kZWxzLCBBbWljYXJzRXZhbHVhdGlvblJlY29yZCwgZXF1aWZheFJlc3BvbnNlLCBjdXN0b21lclJlcXVlc3QpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgcHJlcGFyZWRDdXN0b21lckRhdGEgPSBwcmVwYXJlQ3VzdG9tZXJEYXRhKEFtaWNhcnNFdmFsdWF0aW9uUmVjb3JkLCBlcXVpZmF4UmVzcG9uc2UsIGN1c3RvbWVyUmVxdWVzdCk7XHJcbiAgICBjb25zdCB7IEN1c3RvbWVyRGF0YVBnTW9kZWwgfSA9IGNvbW1vbk1vZGVscztcclxuICAgIGNvbnN0IFtDdXN0b21lckRhdGEsIGNyZWF0ZWRdID0gYXdhaXQgQ3VzdG9tZXJEYXRhUGdNb2RlbC5maW5kT3JDcmVhdGUoe1xyXG4gICAgICB3aGVyZToge1xyXG4gICAgICAgIGlkZW50aWZpY2F0aW9uVHlwZUlkOiAxLFxyXG4gICAgICAgIGlkZW50aWZpY2F0aW9uVmFsdWU6IEFtaWNhcnNFdmFsdWF0aW9uUmVjb3JkLmlkZW50aWZpZXJWYWx1ZSxcclxuICAgICAgfSxcclxuICAgICAgZGVmYXVsdHM6IHByZXBhcmVkQ3VzdG9tZXJEYXRhLFxyXG4gICAgfSk7XHJcblxyXG4gICAgaWYgKCFjcmVhdGVkKSB7XHJcbiAgICAgIEN1c3RvbWVyRGF0YS51cGRhdGUocHJlcGFyZWRDdXN0b21lckRhdGEpO1xyXG4gICAgfVxyXG4gIH0gY2F0Y2ggKGVycikge1xyXG4gICAgY29uc29sZS5sb2coYEVSUk9SOiAke2Vyci5tZXNzYWdlfWApO1xyXG4gIH1cclxufTtcclxuXHJcbmNvbnN0IGNyZWF0ZUFtaWNhcnNFdmFsdWF0aW9uUmVjb3JkID0gYXN5bmMgKGNvbW1vbk1vZGVscywgQW1pY2Fyc0V2YWx1YXRpb25SZWNvcmQpID0+XHJcbiAgY29tbW9uTW9kZWxzLkFtaWNhcnNFdmFsdWF0aW9uUGdNb2RlbC5maW5kT3JDcmVhdGUoe1xyXG4gICAgd2hlcmU6IHtcclxuICAgICAgaWRlbnRpZmllclZhbHVlOiBBbWljYXJzRXZhbHVhdGlvblJlY29yZC5pZGVudGlmaWVyVmFsdWUsXHJcbiAgICB9LFxyXG4gICAgZGVmYXVsdHM6IEFtaWNhcnNFdmFsdWF0aW9uUmVjb3JkLFxyXG4gIH0pLnRoZW4oKFtBbWljYXJzRXZhbHVhdGlvbiwgY3JlYXRlZF0pID0+IHtcclxuICAgIGlmICghY3JlYXRlZCkge1xyXG4gICAgICByZXR1cm4gQW1pY2Fyc0V2YWx1YXRpb24udXBkYXRlKEFtaWNhcnNFdmFsdWF0aW9uUmVjb3JkKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gQW1pY2Fyc0V2YWx1YXRpb247XHJcbiAgfSk7XHJcbmNvbnN0IGV2YWx1YXRlRXF1aWZheEFuZEN1c3RvbWVyRGF0YUVsaWdpYmlsaXR5Rm9yTG9hbiA9IChhbWljYXJzRXZhbHVhdGlvbikgPT5cclxuICAvKlxyXG4gICAqIEV2YWx1YXRlIHVzaW5nIERlY2lzaW9uIEVuZ2luZSBkYXRhXHJcbiAgICovXHJcbiAgYW1pY2Fyc0V2YWx1YXRpb24uYWdlV2l0aGluUGFyYW1ldGVycyAmJlxyXG4gIGFtaWNhcnNFdmFsdWF0aW9uLm1pbmltdW1JbmNvbWVXaXRoaW5QYXJhbWV0ZXJzICYmXHJcbiAgYW1pY2Fyc0V2YWx1YXRpb24uZmluYW5jaW5nQW1vdW50V2l0aGluUGFyYW1ldGVycyAmJlxyXG4gIGFtaWNhcnNFdmFsdWF0aW9uLmZpbmFuY2luZ0Ftb3VudFBlcmNlbnRhZ2VXaXRoaW5QYXJhbWV0ZXJzICYmXHJcbiAgYW1pY2Fyc0V2YWx1YXRpb24uZXF1aWZheFNjb3JlV2l0aGluUGFyYW1ldGVycyAmJlxyXG4gIGFtaWNhcnNFdmFsdWF0aW9uLmRlbGlucXVlbmNpZXNXaXRoaW5QYXJhbWV0ZXJzO1xyXG5cclxuY29uc3QgZXZhbHVhdGVSZXF1ZXN0ID0gYXN5bmMgKGRlcHMsIGN1c3RvbWVyUmVxdWVzdCkgPT4ge1xyXG4gIGNvbnN0IHsgY29tbW9uTW9kZWxzIH0gPSBkZXBzO1xyXG5cclxuICBjb25zdCBidWlsZFBheWxvYWRFcXVpZmF4ID0gKGJvZHkpID0+IHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIGlkZW50aWZpZXJUeXBlOiBjdXN0b21lclJlcXVlc3QuaWRlbnRpZmllclR5cGUsXHJcbiAgICAgIGlkZW50aWZpZXJWYWx1ZTogY3VzdG9tZXJSZXF1ZXN0LmlkZW50aWZpZXJWYWx1ZSxcclxuICAgICAgaW5jb21lOiBjdXN0b21lclJlcXVlc3QuaW5jb21lLFxyXG4gICAgfTtcclxuICB9O1xyXG5cclxuICBjb25zdCB7IHJlc3VsdDogZXF1aWZheEh0dHBPYmosIGVycm9yLCBjYWNoZWQgfSA9IGF3YWl0IGdldEVxdWlmYXgoZGVwcywgYnVpbGRQYXlsb2FkRXF1aWZheChjdXN0b21lclJlcXVlc3QpKTtcclxuXHJcbiAgaWYgKCFlcnJvcikge1xyXG4gICAgY29uc3QgcHJlcGFyZWRBbWljYXJzRXZhbHVhdGlvblJlY29yZCA9IGF3YWl0IGZvcm1hdEFtaWNhcnNFdmFsdWF0aW9uKGRlcHMsIGVxdWlmYXhIdHRwT2JqLCBjdXN0b21lclJlcXVlc3QpO1xyXG5cclxuICAgIGNvbnN0IEFtaWNhcnNFdmFsdWF0aW9uUmVjb3JkID0gYXdhaXQgY3JlYXRlQW1pY2Fyc0V2YWx1YXRpb25SZWNvcmQoY29tbW9uTW9kZWxzLCBwcmVwYXJlZEFtaWNhcnNFdmFsdWF0aW9uUmVjb3JkKTtcclxuXHJcbiAgICBwZXJzaXN0UmVxdWVzdERhdGEoY29tbW9uTW9kZWxzLCBBbWljYXJzRXZhbHVhdGlvblJlY29yZCwgZXF1aWZheEh0dHBPYmosIGN1c3RvbWVyUmVxdWVzdCk7XHJcbiAgICByZXR1cm4gQW1pY2Fyc0V2YWx1YXRpb25SZWNvcmQ7XHJcbiAgfVxyXG59O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSB7XHJcbiAgZXZhbHVhdGVSZXF1ZXN0LFxyXG5cclxuICAvLyBWYWxpZGF0aW9ucy9FdmFsdWF0aW9uc1xyXG4gIGV2YWx1YXRlRXF1aWZheEFuZEN1c3RvbWVyRGF0YUVsaWdpYmlsaXR5Rm9yTG9hbixcclxuICBjcmVhdGVBbWljYXJzRXZhbHVhdGlvblJlY29yZCxcclxufTtcclxuIl19