function cov_1vaf137flb(){var path="/vagrant/continuum/core/src/common/middlewares/tokenValidation.js";var hash="c1bd4cb5b5c09328faa7a83c9c6fd9410810fdc4";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/vagrant/continuum/core/src/common/middlewares/tokenValidation.js",statementMap:{"0":{start:{line:1,column:0},end:{line:26,column:2}},"1":{start:{line:1,column:35},end:{line:26,column:1}},"2":{start:{line:2,column:2},end:{line:25,column:3}},"3":{start:{line:6,column:8},end:{line:6,column:20}},"4":{start:{line:9,column:8},end:{line:9,column:11}},"5":{start:{line:10,column:4},end:{line:12,column:5}},"6":{start:{line:11,column:6},end:{line:11,column:115}},"7":{start:{line:13,column:17},end:{line:13,column:64}},"8":{start:{line:14,column:4},end:{line:16,column:5}},"9":{start:{line:15,column:6},end:{line:15,column:98}},"10":{start:{line:17,column:24},end:{line:17,column:70}},"11":{start:{line:18,column:4},end:{line:20,column:5}},"12":{start:{line:19,column:6},end:{line:19,column:98}},"13":{start:{line:21,column:4},end:{line:21,column:20}},"14":{start:{line:22,column:4},end:{line:22,column:11}},"15":{start:{line:24,column:4},end:{line:24,column:70}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:1,column:17},end:{line:1,column:18}},loc:{start:{line:1,column:35},end:{line:26,column:1}},line:1},"1":{name:"(anonymous_1)",decl:{start:{line:1,column:35},end:{line:1,column:36}},loc:{start:{line:1,column:61},end:{line:26,column:1}},line:1}},branchMap:{"0":{loc:{start:{line:10,column:4},end:{line:12,column:5}},type:"if",locations:[{start:{line:10,column:4},end:{line:12,column:5}},{start:{line:10,column:4},end:{line:12,column:5}}],line:10},"1":{loc:{start:{line:14,column:4},end:{line:16,column:5}},type:"if",locations:[{start:{line:14,column:4},end:{line:16,column:5}},{start:{line:14,column:4},end:{line:16,column:5}}],line:14},"2":{loc:{start:{line:18,column:4},end:{line:20,column:5}},type:"if",locations:[{start:{line:18,column:4},end:{line:20,column:5}},{start:{line:18,column:4},end:{line:20,column:5}}],line:18}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0},f:{"0":0,"1":0},b:{"0":[0,0],"1":[0,0],"2":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"c1bd4cb5b5c09328faa7a83c9c6fd9410810fdc4"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_1vaf137flb=function(){return actualCoverage;};}return actualCoverage;}cov_1vaf137flb();cov_1vaf137flb().s[0]++;module.exports=dependencies=>{cov_1vaf137flb().f[0]++;cov_1vaf137flb().s[1]++;return async(req,res,next)=>{cov_1vaf137flb().f[1]++;cov_1vaf137flb().s[2]++;try{const{commonHelpers:{RestObjectException,jwt},models:{UserPgModel}}=(cov_1vaf137flb().s[3]++,dependencies);const{headers:{authorization:token}}=(cov_1vaf137flb().s[4]++,req);cov_1vaf137flb().s[5]++;if(!token){cov_1vaf137flb().b[0][0]++;cov_1vaf137flb().s[6]++;throw new RestObjectException({message:'Authorization header required',statusCode:400,errorCode:107});}else{cov_1vaf137flb().b[0][1]++;}const user=(cov_1vaf137flb().s[7]++,await UserPgModel.findOne({where:{token}}));cov_1vaf137flb().s[8]++;if(!user){cov_1vaf137flb().b[1][0]++;cov_1vaf137flb().s[9]++;throw new RestObjectException({message:'Unauthorized',statusCode:401,errorCode:108});}else{cov_1vaf137flb().b[1][1]++;}const tokenVerify=(cov_1vaf137flb().s[10]++,await jwt.verify(token.replace('Bearer ','')));cov_1vaf137flb().s[11]++;if(!tokenVerify){cov_1vaf137flb().b[2][0]++;cov_1vaf137flb().s[12]++;throw new RestObjectException({message:'Unauthorized',statusCode:401,errorCode:109});}else{cov_1vaf137flb().b[2][1]++;}cov_1vaf137flb().s[13]++;req.user=user;cov_1vaf137flb().s[14]++;next();}catch({message,statusCode,errorCode}){cov_1vaf137flb().s[15]++;return res.status(statusCode).json({error:message,errorCode});}};};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRva2VuVmFsaWRhdGlvbi5qcyJdLCJuYW1lcyI6WyJtb2R1bGUiLCJleHBvcnRzIiwiZGVwZW5kZW5jaWVzIiwicmVxIiwicmVzIiwibmV4dCIsImNvbW1vbkhlbHBlcnMiLCJSZXN0T2JqZWN0RXhjZXB0aW9uIiwiand0IiwibW9kZWxzIiwiVXNlclBnTW9kZWwiLCJoZWFkZXJzIiwiYXV0aG9yaXphdGlvbiIsInRva2VuIiwibWVzc2FnZSIsInN0YXR1c0NvZGUiLCJlcnJvckNvZGUiLCJ1c2VyIiwiZmluZE9uZSIsIndoZXJlIiwidG9rZW5WZXJpZnkiLCJ2ZXJpZnkiLCJyZXBsYWNlIiwic3RhdHVzIiwianNvbiIsImVycm9yIl0sIm1hcHBpbmdzIjoiaThFQWVZO21IQWZaQSxNQUFNLENBQUNDLE9BQVAsQ0FBa0JDLFlBQUQsRUFBa0IsOERBQU9DLEdBQVAsQ0FBWUMsR0FBWixDQUFpQkMsSUFBakIsR0FBMEIsaURBQzNELEdBQUksQ0FDRixLQUFNLENBQ0pDLGFBQWEsQ0FBRSxDQUFFQyxtQkFBRixDQUF1QkMsR0FBdkIsQ0FEWCxDQUVKQyxNQUFNLENBQUUsQ0FBRUMsV0FBRixDQUZKLDJCQUdGUixZQUhFLENBQU4sQ0FJQSxLQUFNLENBQ0pTLE9BQU8sQ0FBRSxDQUFFQyxhQUFhLENBQUVDLEtBQWpCLENBREwsMkJBRUZWLEdBRkUsQ0FBTixDQUxFLHdCQVFGLEdBQUksQ0FBQ1UsS0FBTCxDQUFZLG9EQUNWLEtBQU0sSUFBSU4sQ0FBQUEsbUJBQUosQ0FBd0IsQ0FBRU8sT0FBTyxDQUFFLCtCQUFYLENBQTRDQyxVQUFVLENBQUUsR0FBeEQsQ0FBNkRDLFNBQVMsQ0FBRSxHQUF4RSxDQUF4QixDQUFOLENBQ0QsQ0FGRCxpQ0FHQSxLQUFNQyxDQUFBQSxJQUFJLDBCQUFHLEtBQU1QLENBQUFBLFdBQVcsQ0FBQ1EsT0FBWixDQUFvQixDQUFFQyxLQUFLLENBQUUsQ0FBRU4sS0FBRixDQUFULENBQXBCLENBQVQsQ0FBVixDQVhFLHdCQVlGLEdBQUksQ0FBQ0ksSUFBTCxDQUFXLG9EQUNULEtBQU0sSUFBSVYsQ0FBQUEsbUJBQUosQ0FBd0IsQ0FBRU8sT0FBTyxDQUFFLGNBQVgsQ0FBMkJDLFVBQVUsQ0FBRSxHQUF2QyxDQUE0Q0MsU0FBUyxDQUFFLEdBQXZELENBQXhCLENBQU4sQ0FDRCxDQUZELGlDQUdBLEtBQU1JLENBQUFBLFdBQVcsMkJBQUcsS0FBTVosQ0FBQUEsR0FBRyxDQUFDYSxNQUFKLENBQVdSLEtBQUssQ0FBQ1MsT0FBTixDQUFjLFNBQWQsQ0FBeUIsRUFBekIsQ0FBWCxDQUFULENBQWpCLENBZkUseUJBZ0JGLEdBQUksQ0FBQ0YsV0FBTCxDQUFrQixxREFDaEIsS0FBTSxJQUFJYixDQUFBQSxtQkFBSixDQUF3QixDQUFFTyxPQUFPLENBQUUsY0FBWCxDQUEyQkMsVUFBVSxDQUFFLEdBQXZDLENBQTRDQyxTQUFTLENBQUUsR0FBdkQsQ0FBeEIsQ0FBTixDQUNELENBRkQsaUNBaEJFLHlCQW1CRmIsR0FBRyxDQUFDYyxJQUFKLENBQVdBLElBQVgsQ0FuQkUseUJBb0JGWixJQUFJLEdBQ0wsQ0FBQyxNQUFPLENBQUVTLE9BQUYsQ0FBV0MsVUFBWCxDQUF1QkMsU0FBdkIsQ0FBUCxDQUEyQywwQkFDM0MsTUFBT1osQ0FBQUEsR0FBRyxDQUFDbUIsTUFBSixDQUFXUixVQUFYLEVBQXVCUyxJQUF2QixDQUE0QixDQUFFQyxLQUFLLENBQUVYLE9BQVQsQ0FBa0JFLFNBQWxCLENBQTVCLENBQVAsQ0FDRCxDQUNGLENBekJrQyxDQXlCbEMsQ0F6QkQiLCJzb3VyY2VzQ29udGVudCI6WyJtb2R1bGUuZXhwb3J0cyA9IChkZXBlbmRlbmNpZXMpID0+IGFzeW5jIChyZXEsIHJlcywgbmV4dCkgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7XHJcbiAgICAgIGNvbW1vbkhlbHBlcnM6IHsgUmVzdE9iamVjdEV4Y2VwdGlvbiwgand0IH0sXHJcbiAgICAgIG1vZGVsczogeyBVc2VyUGdNb2RlbCB9LFxyXG4gICAgfSA9IGRlcGVuZGVuY2llcztcclxuICAgIGNvbnN0IHtcclxuICAgICAgaGVhZGVyczogeyBhdXRob3JpemF0aW9uOiB0b2tlbiB9LFxyXG4gICAgfSA9IHJlcTtcclxuICAgIGlmICghdG9rZW4pIHtcclxuICAgICAgdGhyb3cgbmV3IFJlc3RPYmplY3RFeGNlcHRpb24oeyBtZXNzYWdlOiAnQXV0aG9yaXphdGlvbiBoZWFkZXIgcmVxdWlyZWQnLCBzdGF0dXNDb2RlOiA0MDAsIGVycm9yQ29kZTogMTA3IH0pO1xyXG4gICAgfVxyXG4gICAgY29uc3QgdXNlciA9IGF3YWl0IFVzZXJQZ01vZGVsLmZpbmRPbmUoeyB3aGVyZTogeyB0b2tlbiB9IH0pO1xyXG4gICAgaWYgKCF1c2VyKSB7XHJcbiAgICAgIHRocm93IG5ldyBSZXN0T2JqZWN0RXhjZXB0aW9uKHsgbWVzc2FnZTogJ1VuYXV0aG9yaXplZCcsIHN0YXR1c0NvZGU6IDQwMSwgZXJyb3JDb2RlOiAxMDggfSk7XHJcbiAgICB9XHJcbiAgICBjb25zdCB0b2tlblZlcmlmeSA9IGF3YWl0IGp3dC52ZXJpZnkodG9rZW4ucmVwbGFjZSgnQmVhcmVyICcsICcnKSk7XHJcbiAgICBpZiAoIXRva2VuVmVyaWZ5KSB7XHJcbiAgICAgIHRocm93IG5ldyBSZXN0T2JqZWN0RXhjZXB0aW9uKHsgbWVzc2FnZTogJ1VuYXV0aG9yaXplZCcsIHN0YXR1c0NvZGU6IDQwMSwgZXJyb3JDb2RlOiAxMDkgfSk7XHJcbiAgICB9XHJcbiAgICByZXEudXNlciA9IHVzZXI7XHJcbiAgICBuZXh0KCk7XHJcbiAgfSBjYXRjaCAoeyBtZXNzYWdlLCBzdGF0dXNDb2RlLCBlcnJvckNvZGUgfSkge1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoc3RhdHVzQ29kZSkuanNvbih7IGVycm9yOiBtZXNzYWdlLCBlcnJvckNvZGUgfSk7XHJcbiAgfVxyXG59O1xyXG4iXX0=