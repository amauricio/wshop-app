function cov_2okkw1i2lk(){var path="/vagrant/continuum/core/src/modules/pre-evaluation/middlewares/default/fn/decisionEngine.js";var hash="8e933de79e4e24b44c0a5f30eb6e161f768760d6";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/vagrant/continuum/core/src/modules/pre-evaluation/middlewares/default/fn/decisionEngine.js",statementMap:{"0":{start:{line:1,column:19},end:{line:1,column:71}},"1":{start:{line:2,column:23},end:{line:2,column:90}},"2":{start:{line:3,column:15},end:{line:3,column:32}},"3":{start:{line:5,column:24},end:{line:24,column:1}},"4":{start:{line:6,column:2},end:{line:23,column:4}},"5":{start:{line:25,column:28},end:{line:30,column:1}},"6":{start:{line:26,column:2},end:{line:29,column:4}},"7":{start:{line:32,column:23},end:{line:105,column:1}},"8":{start:{line:33,column:33},end:{line:33,column:58}},"9":{start:{line:34,column:22},end:{line:36,column:4}},"10":{start:{line:37,column:2},end:{line:39,column:3}},"11":{start:{line:38,column:4},end:{line:38,column:50}},"12":{start:{line:40,column:20},end:{line:40,column:39}},"13":{start:{line:42,column:25},end:{line:42,column:50}},"14":{start:{line:43,column:18},end:{line:43,column:64}},"15":{start:{line:46,column:15},end:{line:46,column:26}},"16":{start:{line:47,column:22},end:{line:47,column:30}},"17":{start:{line:49,column:18},end:{line:49,column:67}},"18":{start:{line:50,column:16},end:{line:50,column:50}},"19":{start:{line:52,column:21},end:{line:52,column:28}},"20":{start:{line:53,column:17},end:{line:53,column:64}},"21":{start:{line:54,column:17},end:{line:54,column:50}},"22":{start:{line:56,column:17},end:{line:56,column:19}},"23":{start:{line:57,column:2},end:{line:57,column:30}},"24":{start:{line:58,column:2},end:{line:58,column:31}},"25":{start:{line:59,column:2},end:{line:59,column:34}},"26":{start:{line:62,column:2},end:{line:65,column:3}},"27":{start:{line:63,column:4},end:{line:63,column:70}},"28":{start:{line:64,column:4},end:{line:64,column:20}},"29":{start:{line:68,column:2},end:{line:68,column:32}},"30":{start:{line:69,column:2},end:{line:72,column:3}},"31":{start:{line:70,column:4},end:{line:70,column:64}},"32":{start:{line:71,column:4},end:{line:71,column:20}},"33":{start:{line:75,column:2},end:{line:75,column:32}},"34":{start:{line:77,column:2},end:{line:86,column:3}},"35":{start:{line:79,column:4},end:{line:82,column:5}},"36":{start:{line:80,column:6},end:{line:80,column:69}},"37":{start:{line:81,column:6},end:{line:81,column:22}},"38":{start:{line:83,column:4},end:{line:83,column:57}},"39":{start:{line:85,column:4},end:{line:85,column:35}},"40":{start:{line:87,column:2},end:{line:102,column:3}},"41":{start:{line:88,column:23},end:{line:88,column:59}},"42":{start:{line:89,column:22},end:{line:89,column:60}},"43":{start:{line:90,column:4},end:{line:90,column:60}},"44":{start:{line:90,column:25},end:{line:90,column:60}},"45":{start:{line:92,column:4},end:{line:92,column:38}},"46":{start:{line:93,column:4},end:{line:96,column:5}},"47":{start:{line:94,column:6},end:{line:94,column:38}},"48":{start:{line:95,column:6},end:{line:95,column:42}},"49":{start:{line:97,column:4},end:{line:97,column:20}},"50":{start:{line:99,column:4},end:{line:99,column:37}},"51":{start:{line:100,column:4},end:{line:100,column:62}},"52":{start:{line:101,column:4},end:{line:101,column:20}},"53":{start:{line:104,column:2},end:{line:104,column:18}},"54":{start:{line:106,column:0},end:{line:108,column:2}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:5,column:24},end:{line:5,column:25}},loc:{start:{line:5,column:42},end:{line:24,column:1}},line:5},"1":{name:"(anonymous_1)",decl:{start:{line:25,column:28},end:{line:25,column:29}},loc:{start:{line:25,column:38},end:{line:30,column:1}},line:25},"2":{name:"(anonymous_2)",decl:{start:{line:32,column:23},end:{line:32,column:24}},loc:{start:{line:32,column:53},end:{line:105,column:1}},line:32}},branchMap:{"0":{loc:{start:{line:15,column:11},end:{line:15,column:94}},type:"cond-expr",locations:[{start:{line:15,column:54},end:{line:15,column:90}},{start:{line:15,column:93},end:{line:15,column:94}}],line:15},"1":{loc:{start:{line:37,column:2},end:{line:39,column:3}},type:"if",locations:[{start:{line:37,column:2},end:{line:39,column:3}},{start:{line:37,column:2},end:{line:39,column:3}}],line:37},"2":{loc:{start:{line:49,column:25},end:{line:49,column:54}},type:"binary-expr",locations:[{start:{line:49,column:25},end:{line:49,column:38}},{start:{line:49,column:42},end:{line:49,column:54}}],line:49},"3":{loc:{start:{line:62,column:2},end:{line:65,column:3}},type:"if",locations:[{start:{line:62,column:2},end:{line:65,column:3}},{start:{line:62,column:2},end:{line:65,column:3}}],line:62},"4":{loc:{start:{line:62,column:6},end:{line:62,column:36}},type:"binary-expr",locations:[{start:{line:62,column:6},end:{line:62,column:19}},{start:{line:62,column:23},end:{line:62,column:36}}],line:62},"5":{loc:{start:{line:69,column:2},end:{line:72,column:3}},type:"if",locations:[{start:{line:69,column:2},end:{line:72,column:3}},{start:{line:69,column:2},end:{line:72,column:3}}],line:69},"6":{loc:{start:{line:77,column:2},end:{line:86,column:3}},type:"if",locations:[{start:{line:77,column:2},end:{line:86,column:3}},{start:{line:77,column:2},end:{line:86,column:3}}],line:77},"7":{loc:{start:{line:79,column:4},end:{line:82,column:5}},type:"if",locations:[{start:{line:79,column:4},end:{line:82,column:5}},{start:{line:79,column:4},end:{line:82,column:5}}],line:79},"8":{loc:{start:{line:87,column:2},end:{line:102,column:3}},type:"if",locations:[{start:{line:87,column:2},end:{line:102,column:3}},{start:{line:87,column:2},end:{line:102,column:3}}],line:87},"9":{loc:{start:{line:90,column:4},end:{line:90,column:60}},type:"if",locations:[{start:{line:90,column:4},end:{line:90,column:60}},{start:{line:90,column:4},end:{line:90,column:60}}],line:90},"10":{loc:{start:{line:93,column:4},end:{line:96,column:5}},type:"if",locations:[{start:{line:93,column:4},end:{line:96,column:5}},{start:{line:93,column:4},end:{line:96,column:5}}],line:93}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0},f:{"0":0,"1":0,"2":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"8e933de79e4e24b44c0a5f30eb6e161f768760d6"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_2okkw1i2lk=function(){return actualCoverage;};}return actualCoverage;}cov_2okkw1i2lk();const{getWic}=(cov_2okkw1i2lk().s[0]++,require('modules/evaluation/middlewares/wic/getWic'));const{getEquifax}=(cov_2okkw1i2lk().s[1]++,require('modules/evaluation/middlewares/chl/v1/equifax/getEquifax'));const moment=(cov_2okkw1i2lk().s[2]++,require('moment'));cov_2okkw1i2lk().s[3]++;const buildPayloadWic=(body,income)=>{cov_2okkw1i2lk().f[0]++;cov_2okkw1i2lk().s[4]++;return{model_type:'Logit',staging:'PRODUCTION',workType:body.workType,is_new:body.vehicleType.includes('NUEVO'),lightweight:body.vehicleType.includes('LIVIANO'),nationality:body.nationality,term:body.term,vehiclePrice:body.vehiclePrice,total:body.vehiclePrice-body.downPayment>0?(cov_2okkw1i2lk().b[0][0]++,body.vehiclePrice-body.downPayment):(cov_2okkw1i2lk().b[0][1]++,0),downPayment:body.downPayment,income:income,tradeInCarValue:body.tradeInCarValue,monthlyPayment:body.monthlyPayment,workEntryDate:body.workEntryDate,//  "workStartDate": "2012-10-10"
workStartDate:moment().format('YYYY-MM-DD')};};cov_2okkw1i2lk().s[5]++;const buildPayloadEquifax=body=>{cov_2okkw1i2lk().f[1]++;cov_2okkw1i2lk().s[6]++;return{identifierType:'RUT',identifierValue:body.rut};};cov_2okkw1i2lk().s[7]++;const decisionEngine=async(dependencies,body)=>{cov_2okkw1i2lk().f[2]++;const{CoreSettingPgModel}=(cov_2okkw1i2lk().s[8]++,dependencies.commonModels);const coreSetting=(cov_2okkw1i2lk().s[9]++,await CoreSettingPgModel.findOne({where:{type:'PREEVALUATION_MAX_VEHICLE_YEARS'}}));cov_2okkw1i2lk().s[10]++;if(!coreSetting){cov_2okkw1i2lk().b[1][0]++;cov_2okkw1i2lk().s[11]++;throw new RestException(errors.ERROR_SERVICE);}else{cov_2okkw1i2lk().b[1][1]++;}const{years}=(cov_2okkw1i2lk().s[12]++,coreSetting.setting);const payloadEquifax=(cov_2okkw1i2lk().s[13]++,buildPayloadEquifax(body));const equifax=(cov_2okkw1i2lk().s[14]++,await getEquifax(dependencies,payloadEquifax));//tiene morosidad
let status=(cov_2okkw1i2lk().s[15]++,'RECHAZADO');const currentDate=(cov_2okkw1i2lk().s[16]++,moment());const dateCar=(cov_2okkw1i2lk().s[17]++,moment((cov_2okkw1i2lk().b[2][0]++,body.car_year)||(cov_2okkw1i2lk().b[2][1]++,'0001-01-01'),'YYYYMMDD'));var diffCar=(cov_2okkw1i2lk().s[18]++,currentDate.diff(dateCar,'years'));const{result}=(cov_2okkw1i2lk().s[19]++,equifax);const fecNac=(cov_2okkw1i2lk().s[20]++,moment(result.equifaxReportedDob,'YYYY-MM-DD'));var diffEdad=(cov_2okkw1i2lk().s[21]++,currentDate.diff(fecNac,'years'));var response=(cov_2okkw1i2lk().s[22]++,{});cov_2okkw1i2lk().s[23]++;response['result']=status;//rechazado
cov_2okkw1i2lk().s[24]++;response['resultDesc']='.';cov_2okkw1i2lk().s[25]++;response['diffEdad']=diffEdad;//diff edad validation
cov_2okkw1i2lk().s[26]++;if((cov_2okkw1i2lk().b[4][0]++,diffEdad<20)||(cov_2okkw1i2lk().b[4][1]++,diffEdad>75)){cov_2okkw1i2lk().b[3][0]++;cov_2okkw1i2lk().s[27]++;response['resultDesc']='La edad es menor que 20 o mayor que 75';cov_2okkw1i2lk().s[28]++;return response;}else{cov_2okkw1i2lk().b[3][1]++;}//diff car validation
cov_2okkw1i2lk().s[29]++;response['diffCar']=diffCar;cov_2okkw1i2lk().s[30]++;if(diffCar>years){cov_2okkw1i2lk().b[5][0]++;cov_2okkw1i2lk().s[31]++;response['resultDesc']='AÃ±os del vehiculo es mayor que 7';cov_2okkw1i2lk().s[32]++;return response;}else{cov_2okkw1i2lk().b[5][1]++;}//equifax
cov_2okkw1i2lk().s[33]++;response['equifax']=equifax;let incomeDefault;cov_2okkw1i2lk().s[34]++;if(!("income"in body)){cov_2okkw1i2lk().b[6][0]++;cov_2okkw1i2lk().s[35]++;//only if income is not defined
if(equifax.result.equifaxReportedIncome==0){cov_2okkw1i2lk().b[7][0]++;cov_2okkw1i2lk().s[36]++;response['resultDesc']='Equifax::equifaxReportedIncome es 0';cov_2okkw1i2lk().s[37]++;return response;}else{cov_2okkw1i2lk().b[7][1]++;}cov_2okkw1i2lk().s[38]++;incomeDefault=equifax.result.equifaxReportedIncome;}else{cov_2okkw1i2lk().b[6][1]++;cov_2okkw1i2lk().s[39]++;incomeDefault=body['income'];}cov_2okkw1i2lk().s[40]++;if(equifax.result.getDelinquency==0){cov_2okkw1i2lk().b[8][0]++;const payloadWic=(cov_2okkw1i2lk().s[41]++,buildPayloadWic(body,incomeDefault));const resultWic=(cov_2okkw1i2lk().s[42]++,await getWic(dependencies,payloadWic));cov_2okkw1i2lk().s[43]++;if(resultWic.error){cov_2okkw1i2lk().b[9][0]++;cov_2okkw1i2lk().s[44]++;return{result:'NO DISPONIBLE'};}else{cov_2okkw1i2lk().b[9][1]++;}cov_2okkw1i2lk().s[45]++;response['resultWic']=resultWic;cov_2okkw1i2lk().s[46]++;if(resultWic.resultWicValidate=='APROBADO'){cov_2okkw1i2lk().b[10][0]++;cov_2okkw1i2lk().s[47]++;response['result']='APROBADO';cov_2okkw1i2lk().s[48]++;response['resultDesc']='Aprobado';}else{cov_2okkw1i2lk().b[10][1]++;}cov_2okkw1i2lk().s[49]++;return response;}else{cov_2okkw1i2lk().b[8][1]++;cov_2okkw1i2lk().s[50]++;response['result']='RECHAZADO';cov_2okkw1i2lk().s[51]++;response['resultDesc']='Equifax::getDelinquency failed';cov_2okkw1i2lk().s[52]++;return response;}cov_2okkw1i2lk().s[53]++;return response;};cov_2okkw1i2lk().s[54]++;module.exports={decisionEngine};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRlY2lzaW9uRW5naW5lLmpzIl0sIm5hbWVzIjpbImdldFdpYyIsInJlcXVpcmUiLCJnZXRFcXVpZmF4IiwibW9tZW50IiwiYnVpbGRQYXlsb2FkV2ljIiwiYm9keSIsImluY29tZSIsIm1vZGVsX3R5cGUiLCJzdGFnaW5nIiwid29ya1R5cGUiLCJpc19uZXciLCJ2ZWhpY2xlVHlwZSIsImluY2x1ZGVzIiwibGlnaHR3ZWlnaHQiLCJuYXRpb25hbGl0eSIsInRlcm0iLCJ2ZWhpY2xlUHJpY2UiLCJ0b3RhbCIsImRvd25QYXltZW50IiwidHJhZGVJbkNhclZhbHVlIiwibW9udGhseVBheW1lbnQiLCJ3b3JrRW50cnlEYXRlIiwid29ya1N0YXJ0RGF0ZSIsImZvcm1hdCIsImJ1aWxkUGF5bG9hZEVxdWlmYXgiLCJpZGVudGlmaWVyVHlwZSIsImlkZW50aWZpZXJWYWx1ZSIsInJ1dCIsImRlY2lzaW9uRW5naW5lIiwiZGVwZW5kZW5jaWVzIiwiQ29yZVNldHRpbmdQZ01vZGVsIiwiY29tbW9uTW9kZWxzIiwiY29yZVNldHRpbmciLCJmaW5kT25lIiwid2hlcmUiLCJ0eXBlIiwiUmVzdEV4Y2VwdGlvbiIsImVycm9ycyIsIkVSUk9SX1NFUlZJQ0UiLCJ5ZWFycyIsInNldHRpbmciLCJwYXlsb2FkRXF1aWZheCIsImVxdWlmYXgiLCJzdGF0dXMiLCJjdXJyZW50RGF0ZSIsImRhdGVDYXIiLCJjYXJfeWVhciIsImRpZmZDYXIiLCJkaWZmIiwicmVzdWx0IiwiZmVjTmFjIiwiZXF1aWZheFJlcG9ydGVkRG9iIiwiZGlmZkVkYWQiLCJyZXNwb25zZSIsImluY29tZURlZmF1bHQiLCJlcXVpZmF4UmVwb3J0ZWRJbmNvbWUiLCJnZXREZWxpbnF1ZW5jeSIsInBheWxvYWRXaWMiLCJyZXN1bHRXaWMiLCJlcnJvciIsInJlc3VsdFdpY1ZhbGlkYXRlIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6ImdyTkFlWTsyRkFmWixLQUFNLENBQUVBLE1BQUYsMkJBQWFD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UCxDQUNELENBdEVrRCx5QkF3RW5ELE1BQU9BLENBQUFBLFFBQVAsQ0FDRCxDQXpFRCxDLHlCQTBFQVEsTUFBTSxDQUFDQyxPQUFQLENBQWlCLENBQ2ZsQyxjQURlLENBQWpCIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgeyBnZXRXaWMgfSA9IHJlcXVpcmUoJ21vZHVsZXMvZXZhbHVhdGlvbi9taWRkbGV3YXJlcy93aWMvZ2V0V2ljJyk7XHJcbmNvbnN0IHsgZ2V0RXF1aWZheCB9ID0gcmVxdWlyZSgnbW9kdWxlcy9ldmFsdWF0aW9uL21pZGRsZXdhcmVzL2NobC92MS9lcXVpZmF4L2dldEVxdWlmYXgnKTtcclxuY29uc3QgbW9tZW50ID0gcmVxdWlyZSgnbW9tZW50Jyk7XHJcblxyXG5jb25zdCBidWlsZFBheWxvYWRXaWMgPSAoYm9keSwgaW5jb21lKSA9PiB7XHJcbiAgcmV0dXJuIHtcclxuICAgIG1vZGVsX3R5cGU6ICdMb2dpdCcsXHJcbiAgICBzdGFnaW5nOiAnUFJPRFVDVElPTicsXHJcbiAgICB3b3JrVHlwZTogYm9keS53b3JrVHlwZSxcclxuICAgIGlzX25ldzogYm9keS52ZWhpY2xlVHlwZS5pbmNsdWRlcygnTlVFVk8nKSxcclxuICAgIGxpZ2h0d2VpZ2h0OiBib2R5LnZlaGljbGVUeXBlLmluY2x1ZGVzKCdMSVZJQU5PJyksXHJcbiAgICBuYXRpb25hbGl0eTogYm9keS5uYXRpb25hbGl0eSxcclxuICAgIHRlcm06IGJvZHkudGVybSxcclxuICAgIHZlaGljbGVQcmljZTogYm9keS52ZWhpY2xlUHJpY2UsXHJcbiAgICB0b3RhbDogYm9keS52ZWhpY2xlUHJpY2UgLSBib2R5LmRvd25QYXltZW50ID4gMCA/IGJvZHkudmVoaWNsZVByaWNlIC0gYm9keS5kb3duUGF5bWVudCA6IDAsXHJcbiAgICBkb3duUGF5bWVudDogYm9keS5kb3duUGF5bWVudCxcclxuICAgIGluY29tZTogaW5jb21lLFxyXG4gICAgdHJhZGVJbkNhclZhbHVlOiBib2R5LnRyYWRlSW5DYXJWYWx1ZSxcclxuICAgIG1vbnRobHlQYXltZW50OiBib2R5Lm1vbnRobHlQYXltZW50LFxyXG4gICAgd29ya0VudHJ5RGF0ZTogYm9keS53b3JrRW50cnlEYXRlLFxyXG4gICAgLy8gIFwid29ya1N0YXJ0RGF0ZVwiOiBcIjIwMTItMTAtMTBcIlxyXG4gICAgd29ya1N0YXJ0RGF0ZTogbW9tZW50KCkuZm9ybWF0KCdZWVlZLU1NLUREJyksXHJcbiAgfTtcclxufTtcclxuY29uc3QgYnVpbGRQYXlsb2FkRXF1aWZheCA9IChib2R5KSA9PiB7XHJcbiAgcmV0dXJuIHtcclxuICAgIGlkZW50aWZpZXJUeXBlOiAnUlVUJyxcclxuICAgIGlkZW50aWZpZXJWYWx1ZTogYm9keS5ydXQsXHJcbiAgfTtcclxufTtcclxuXHJcbmNvbnN0IGRlY2lzaW9uRW5naW5lID0gYXN5bmMgKGRlcGVuZGVuY2llcywgYm9keSkgPT4ge1xyXG4gIGNvbnN0IHsgQ29yZVNldHRpbmdQZ01vZGVsIH0gPSBkZXBlbmRlbmNpZXMuY29tbW9uTW9kZWxzO1xyXG4gIGNvbnN0IGNvcmVTZXR0aW5nID0gYXdhaXQgQ29yZVNldHRpbmdQZ01vZGVsLmZpbmRPbmUoe1xyXG4gICAgd2hlcmU6IHsgdHlwZTogJ1BSRUVWQUxVQVRJT05fTUFYX1ZFSElDTEVfWUVBUlMnIH0sXHJcbiAgfSk7XHJcbiAgaWYgKCFjb3JlU2V0dGluZykge1xyXG4gICAgdGhyb3cgbmV3IFJlc3RFeGNlcHRpb24oZXJyb3JzLkVSUk9SX1NFUlZJQ0UpO1xyXG4gIH1cclxuICBjb25zdCB7IHllYXJzIH0gPSBjb3JlU2V0dGluZy5zZXR0aW5nO1xyXG5cclxuICBjb25zdCBwYXlsb2FkRXF1aWZheCA9IGJ1aWxkUGF5bG9hZEVxdWlmYXgoYm9keSk7XHJcbiAgY29uc3QgZXF1aWZheCA9IGF3YWl0IGdldEVxdWlmYXgoZGVwZW5kZW5jaWVzLCBwYXlsb2FkRXF1aWZheCk7XHJcbiAgLy90aWVuZSBtb3Jvc2lkYWRcclxuXHJcbiAgbGV0IHN0YXR1cyA9ICdSRUNIQVpBRE8nO1xyXG4gIGNvbnN0IGN1cnJlbnREYXRlID0gbW9tZW50KCk7XHJcblxyXG4gIGNvbnN0IGRhdGVDYXIgPSBtb21lbnQoYm9keS5jYXJfeWVhciB8fCAnMDAwMS0wMS0wMScsICdZWVlZTU1ERCcpO1xyXG4gIHZhciBkaWZmQ2FyID0gY3VycmVudERhdGUuZGlmZihkYXRlQ2FyLCAneWVhcnMnKTtcclxuXHJcbiAgY29uc3QgeyByZXN1bHQgfSA9IGVxdWlmYXg7XHJcbiAgY29uc3QgZmVjTmFjID0gbW9tZW50KHJlc3VsdC5lcXVpZmF4UmVwb3J0ZWREb2IsICdZWVlZLU1NLUREJyk7XHJcbiAgdmFyIGRpZmZFZGFkID0gY3VycmVudERhdGUuZGlmZihmZWNOYWMsICd5ZWFycycpO1xyXG5cclxuICB2YXIgcmVzcG9uc2UgPSB7fTtcclxuICByZXNwb25zZVsncmVzdWx0J10gPSBzdGF0dXM7IC8vcmVjaGF6YWRvXHJcbiAgcmVzcG9uc2VbJ3Jlc3VsdERlc2MnXSA9ICcuJztcclxuICByZXNwb25zZVsnZGlmZkVkYWQnXSA9IGRpZmZFZGFkO1xyXG5cclxuICAvL2RpZmYgZWRhZCB2YWxpZGF0aW9uXHJcbiAgaWYgKGRpZmZFZGFkIDwgMjAgfHwgZGlmZkVkYWQgPiA3NSkge1xyXG4gICAgcmVzcG9uc2VbJ3Jlc3VsdERlc2MnXSA9ICdMYSBlZGFkIGVzIG1lbm9yIHF1ZSAyMCBvIG1heW9yIHF1ZSA3NSc7XHJcbiAgICByZXR1cm4gcmVzcG9uc2U7XHJcbiAgfVxyXG5cclxuICAvL2RpZmYgY2FyIHZhbGlkYXRpb25cclxuICByZXNwb25zZVsnZGlmZkNhciddID0gZGlmZkNhcjtcclxuICBpZiAoZGlmZkNhciA+IHllYXJzKSB7XHJcbiAgICByZXNwb25zZVsncmVzdWx0RGVzYyddID0gJ0HDsW9zIGRlbCB2ZWhpY3VsbyBlcyBtYXlvciBxdWUgNyc7XHJcbiAgICByZXR1cm4gcmVzcG9uc2U7XHJcbiAgfVxyXG5cclxuICAvL2VxdWlmYXhcclxuICByZXNwb25zZVsnZXF1aWZheCddID0gZXF1aWZheDtcclxuICBsZXQgaW5jb21lRGVmYXVsdDtcclxuICBpZighKFwiaW5jb21lXCIgaW4gYm9keSkpe1xyXG4gIC8vb25seSBpZiBpbmNvbWUgaXMgbm90IGRlZmluZWRcclxuICAgIGlmIChlcXVpZmF4LnJlc3VsdC5lcXVpZmF4UmVwb3J0ZWRJbmNvbWUgPT0gMCkge1xyXG4gICAgICByZXNwb25zZVsncmVzdWx0RGVzYyddID0gJ0VxdWlmYXg6OmVxdWlmYXhSZXBvcnRlZEluY29tZSBlcyAwJztcclxuICAgICAgcmV0dXJuIHJlc3BvbnNlO1xyXG4gICAgfVxyXG4gICAgaW5jb21lRGVmYXVsdCA9IGVxdWlmYXgucmVzdWx0LmVxdWlmYXhSZXBvcnRlZEluY29tZTtcclxuICB9ZWxzZXtcclxuICAgIGluY29tZURlZmF1bHQgPSBib2R5WydpbmNvbWUnXTtcclxuICB9XHJcbiAgaWYgKGVxdWlmYXgucmVzdWx0LmdldERlbGlucXVlbmN5ID09IDApIHtcclxuICAgIGNvbnN0IHBheWxvYWRXaWMgPSBidWlsZFBheWxvYWRXaWMoYm9keSwgaW5jb21lRGVmYXVsdCk7XHJcbiAgICBjb25zdCByZXN1bHRXaWMgPSBhd2FpdCBnZXRXaWMoZGVwZW5kZW5jaWVzLCBwYXlsb2FkV2ljKTtcclxuICAgIGlmIChyZXN1bHRXaWMuZXJyb3IpIHJldHVybiB7IHJlc3VsdDogJ05PIERJU1BPTklCTEUnIH07XHJcblxyXG4gICAgcmVzcG9uc2VbJ3Jlc3VsdFdpYyddID0gcmVzdWx0V2ljO1xyXG4gICAgaWYgKHJlc3VsdFdpYy5yZXN1bHRXaWNWYWxpZGF0ZSA9PSAnQVBST0JBRE8nKSB7XHJcbiAgICAgIHJlc3BvbnNlWydyZXN1bHQnXSA9ICdBUFJPQkFETyc7XHJcbiAgICAgIHJlc3BvbnNlWydyZXN1bHREZXNjJ10gPSAnQXByb2JhZG8nO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHJlc3BvbnNlO1xyXG4gIH0gZWxzZSB7XHJcbiAgICByZXNwb25zZVsncmVzdWx0J10gPSAnUkVDSEFaQURPJztcclxuICAgIHJlc3BvbnNlWydyZXN1bHREZXNjJ10gPSAnRXF1aWZheDo6Z2V0RGVsaW5xdWVuY3kgZmFpbGVkJztcclxuICAgIHJldHVybiByZXNwb25zZTtcclxuICB9XHJcblxyXG4gIHJldHVybiByZXNwb25zZTtcclxufTtcclxubW9kdWxlLmV4cG9ydHMgPSB7XHJcbiAgZGVjaXNpb25FbmdpbmUsXHJcbn07XHJcbiJdfQ==