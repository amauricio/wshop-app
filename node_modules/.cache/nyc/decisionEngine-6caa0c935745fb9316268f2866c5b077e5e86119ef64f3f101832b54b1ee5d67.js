function cov_2okkw1i2lk(){var path="/vagrant/continuum/core/src/modules/pre-evaluation/middlewares/default/fn/decisionEngine.js";var hash="7219a7098a5b5838e1b4243e7e0a75ec980ffd65";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/vagrant/continuum/core/src/modules/pre-evaluation/middlewares/default/fn/decisionEngine.js",statementMap:{"0":{start:{line:2,column:19},end:{line:2,column:71}},"1":{start:{line:3,column:23},end:{line:3,column:90}},"2":{start:{line:4,column:15},end:{line:4,column:32}},"3":{start:{line:6,column:24},end:{line:25,column:1}},"4":{start:{line:8,column:4},end:{line:24,column:5}},"5":{start:{line:26,column:28},end:{line:33,column:1}},"6":{start:{line:27,column:4},end:{line:32,column:5}},"7":{start:{line:35,column:23},end:{line:65,column:1}},"8":{start:{line:36,column:35},end:{line:36,column:60}},"9":{start:{line:37,column:24},end:{line:39,column:6}},"10":{start:{line:40,column:4},end:{line:40,column:100}},"11":{start:{line:40,column:22},end:{line:40,column:100}},"12":{start:{line:41,column:22},end:{line:41,column:41}},"13":{start:{line:43,column:27},end:{line:43,column:52}},"14":{start:{line:44,column:20},end:{line:44,column:66}},"15":{start:{line:46,column:17},end:{line:46,column:28}},"16":{start:{line:47,column:24},end:{line:47,column:32}},"17":{start:{line:48,column:20},end:{line:48,column:70}},"18":{start:{line:49,column:15},end:{line:49,column:49}},"19":{start:{line:50,column:4},end:{line:52,column:5}},"20":{start:{line:51,column:8},end:{line:51,column:26}},"21":{start:{line:53,column:4},end:{line:62,column:5}},"22":{start:{line:55,column:27},end:{line:55,column:48}},"23":{start:{line:56,column:23},end:{line:56,column:61}},"24":{start:{line:57,column:8},end:{line:58,column:32}},"25":{start:{line:58,column:12},end:{line:58,column:32}},"26":{start:{line:59,column:8},end:{line:59,column:26}},"27":{start:{line:61,column:8},end:{line:61,column:38}},"28":{start:{line:66,column:0},end:{line:68,column:1}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:6,column:24},end:{line:6,column:25}},loc:{start:{line:6,column:34},end:{line:25,column:1}},line:6},"1":{name:"(anonymous_1)",decl:{start:{line:26,column:28},end:{line:26,column:29}},loc:{start:{line:26,column:37},end:{line:33,column:1}},line:26},"2":{name:"(anonymous_2)",decl:{start:{line:35,column:23},end:{line:35,column:24}},loc:{start:{line:35,column:52},end:{line:65,column:1}},line:35}},branchMap:{"0":{loc:{start:{line:40,column:4},end:{line:40,column:100}},type:"if",locations:[{start:{line:40,column:4},end:{line:40,column:100}},{start:{line:40,column:4},end:{line:40,column:100}}],line:40},"1":{loc:{start:{line:48,column:28},end:{line:48,column:57}},type:"binary-expr",locations:[{start:{line:48,column:28},end:{line:48,column:41}},{start:{line:48,column:45},end:{line:48,column:57}}],line:48},"2":{loc:{start:{line:50,column:4},end:{line:52,column:5}},type:"if",locations:[{start:{line:50,column:4},end:{line:52,column:5}},{start:{line:50,column:4},end:{line:52,column:5}}],line:50},"3":{loc:{start:{line:53,column:4},end:{line:62,column:5}},type:"if",locations:[{start:{line:53,column:4},end:{line:62,column:5}},{start:{line:53,column:4},end:{line:62,column:5}}],line:53},"4":{loc:{start:{line:57,column:8},end:{line:58,column:32}},type:"if",locations:[{start:{line:57,column:8},end:{line:58,column:32}},{start:{line:57,column:8},end:{line:58,column:32}}],line:57}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0},f:{"0":0,"1":0,"2":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"7219a7098a5b5838e1b4243e7e0a75ec980ffd65"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_2okkw1i2lk=function(){return actualCoverage;};}return actualCoverage;}cov_2okkw1i2lk();const{getWic}=(cov_2okkw1i2lk().s[0]++,require('modules/evaluation/middlewares/wic/getWic'));const{getEquifax}=(cov_2okkw1i2lk().s[1]++,require('modules/evaluation/middlewares/chl/v2/equifax/getEquifax'));const moment=(cov_2okkw1i2lk().s[2]++,require('moment'));cov_2okkw1i2lk().s[3]++;const buildPayloadWic=body=>{cov_2okkw1i2lk().f[0]++;cov_2okkw1i2lk().s[4]++;return{"model_type":"Logit","staging":"PRODUCTION","job_type":body.job_type,"is_new":body.car_type.includes("NUEVO"),"lightweight":body.car_type.includes("LIVIANO"),"nationality":body.nationality,"term":body.term,"car_price":body.car_price,"total":body.cash-body.car_price,"cash":body.cash,"income":body.income,"retake":body.retake,"fee_value":body.fee_value,"years_last_job":body.years_last_job,"date_last_job":"2012-10-10"};};cov_2okkw1i2lk().s[5]++;const buildPayloadEquifax=body=>{cov_2okkw1i2lk().f[1]++;cov_2okkw1i2lk().s[6]++;return{"identifierType":"RUT","identifierValue":body.rut,"income":body.income};};cov_2okkw1i2lk().s[7]++;const decisionEngine=async(dependencies,body)=>{cov_2okkw1i2lk().f[2]++;const{CoreSettingPgModel}=(cov_2okkw1i2lk().s[8]++,dependencies.commonModels);const coreSetting=(cov_2okkw1i2lk().s[9]++,await CoreSettingPgModel.findOne({where:{type:'PREEVALUATION_MAX_VEHICLE_YEARS'}}));cov_2okkw1i2lk().s[10]++;if(!coreSetting){cov_2okkw1i2lk().b[0][0]++;cov_2okkw1i2lk().s[11]++;throw new Error('Core setting for PREEVALUATION_MAX_VEHICLE_YEARS not found');}else{cov_2okkw1i2lk().b[0][1]++;}const{years}=(cov_2okkw1i2lk().s[12]++,coreSetting.setting);const payloadEquifax=(cov_2okkw1i2lk().s[13]++,buildPayloadEquifax(body));const equifax=(cov_2okkw1i2lk().s[14]++,await getEquifax(dependencies,payloadEquifax));//tiene morosidad
let status=(cov_2okkw1i2lk().s[15]++,"RECHAZADO");const currentDate=(cov_2okkw1i2lk().s[16]++,moment());const dateCar=(cov_2okkw1i2lk().s[17]++,moment((cov_2okkw1i2lk().b[1][0]++,body.car_year)||(cov_2okkw1i2lk().b[1][1]++,'0001-01-01'),'YYYYMMDD'));var diff=(cov_2okkw1i2lk().s[18]++,currentDate.diff(dateCar,'years'));cov_2okkw1i2lk().s[19]++;if(diff<=years){cov_2okkw1i2lk().b[2][0]++;cov_2okkw1i2lk().s[20]++;return{status};}else{cov_2okkw1i2lk().b[2][1]++;}cov_2okkw1i2lk().s[21]++;if(equifax.result.getDelinquency){cov_2okkw1i2lk().b[3][0]++;const payloadWic=(cov_2okkw1i2lk().s[22]++,buildPayloadWic(body));const result=(cov_2okkw1i2lk().s[23]++,await getWic(dependencies,payloadWic));cov_2okkw1i2lk().s[24]++;if(result=="APROBADO"){cov_2okkw1i2lk().b[4][0]++;cov_2okkw1i2lk().s[25]++;status="APROBADO";}else{cov_2okkw1i2lk().b[4][1]++;}cov_2okkw1i2lk().s[26]++;return{status};}else{cov_2okkw1i2lk().b[3][1]++;cov_2okkw1i2lk().s[27]++;return{result:'RECHAZADO'};}};cov_2okkw1i2lk().s[28]++;module.exports={decisionEngine};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRlY2lzaW9uRW5naW5lLmpzIl0sIm5hbWVzIjpbImdldFdpYyIsInJlcXVpcmUiLCJnZXRFcXVpZmF4IiwibW9tZW50IiwiYnVpbGRQYXlsb2FkV2ljIiwiYm9keSIsImpvYl90eXBlIiwiY2FyX3R5cGUiLCJpbmNsdWRlcyIsIm5hdGlvbmFsaXR5IiwidGVybSIsImNhcl9wcmljZSIsImNhc2giLCJpbmNvbWUiLCJyZXRha2UiLCJmZWVfdmFsdWUiLCJ5ZWFyc19sYXN0X2pvYiIsImJ1aWxkUGF5bG9hZEVxdWlmYXgiLCJydXQiLCJkZWNpc2lvbkVuZ2luZSIsImRlcGVuZGVuY2llcyIsIkNvcmVTZXR0aW5nUGdNb2RlbCIsImNvbW1vbk1vZGVscyIsImNvcmVTZXR0aW5nIiwiZmluZE9uZSIsIndoZXJlIiwidHlwZSIsIkVycm9yIiwieWVhcnMiLCJzZXR0aW5nIiwicGF5bG9hZEVxdWlmYXgiLCJlcXVpZmF4Iiwic3RhdHVzIiwiY3VycmVudERhdGUiLCJkYXRlQ2FyIiwiY2FyX3llYXIiLCJkaWZmIiwicmVzdWx0IiwiZ2V0RGVsaW5xdWVuY3kiLCJwYXlsb2FkV2ljIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IjAzSEFlWTsyRkFkWixLQUFNLENBQUVBLE1BQUYsMkJBQWFDLE9BQU8sQ0FBQywyQ0FBRCxDQUFwQixDQUFOLENBQ0EsS0FBTSxDQUFFQyxVQUFGLDJCQUFpQkQsT0FBTyxDQUFDLDBEQUFELENBQXhCLENBQU4sQ0FDQSxLQUFNRSxDQUFBQSxNQUFNLDBCQUFHRixPQUFPLENBQUMsUUFBRCxDQUFWLENBQVosQyx3QkFFQSxLQUFNRyxDQUFBQSxlQUFlLENBQUlDLElBQUQsRUFBVSxpREFFOUIsTUFBTyxDQUNILGFBQWEsT0FEVixDQUVILFVBQVcsWUFGUixDQUdILFdBQVlBLElBQUksQ0FBQ0MsUUFIZCxDQUlILFNBQVVELElBQUksQ0FBQ0UsUUFBTCxDQUFjQyxRQUFkLENBQXVCLE9BQXZCLENBSlAsQ0FLSCxjQUFlSCxJ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dCI6WyJcclxuY29uc3QgeyBnZXRXaWMgfSA9IHJlcXVpcmUoJ21vZHVsZXMvZXZhbHVhdGlvbi9taWRkbGV3YXJlcy93aWMvZ2V0V2ljJyk7XHJcbmNvbnN0IHsgZ2V0RXF1aWZheCB9ID0gcmVxdWlyZSgnbW9kdWxlcy9ldmFsdWF0aW9uL21pZGRsZXdhcmVzL2NobC92Mi9lcXVpZmF4L2dldEVxdWlmYXgnKTtcclxuY29uc3QgbW9tZW50ID0gcmVxdWlyZSgnbW9tZW50Jyk7XHJcblxyXG5jb25zdCBidWlsZFBheWxvYWRXaWMgPSAoYm9keSkgPT4ge1xyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgXCJtb2RlbF90eXBlXCI6XCJMb2dpdFwiLFxyXG4gICAgICAgIFwic3RhZ2luZ1wiOiBcIlBST0RVQ1RJT05cIixcclxuICAgICAgICBcImpvYl90eXBlXCI6IGJvZHkuam9iX3R5cGUsXHJcbiAgICAgICAgXCJpc19uZXdcIjogYm9keS5jYXJfdHlwZS5pbmNsdWRlcyhcIk5VRVZPXCIpLFxyXG4gICAgICAgIFwibGlnaHR3ZWlnaHRcIjogYm9keS5jYXJfdHlwZS5pbmNsdWRlcyhcIkxJVklBTk9cIiksXHJcbiAgICAgICAgXCJuYXRpb25hbGl0eVwiOmJvZHkubmF0aW9uYWxpdHksXHJcbiAgICAgICAgXCJ0ZXJtXCI6IGJvZHkudGVybSxcclxuICAgICAgICBcImNhcl9wcmljZVwiOiBib2R5LmNhcl9wcmljZSxcclxuICAgICAgICBcInRvdGFsXCI6IChib2R5LmNhc2ggLSBib2R5LmNhcl9wcmljZSksXHJcbiAgICAgICAgXCJjYXNoXCI6IGJvZHkuY2FzaCxcclxuICAgICAgICBcImluY29tZVwiOiBib2R5LmluY29tZSxcclxuICAgICAgICBcInJldGFrZVwiOiAgYm9keS5yZXRha2UsXHJcbiAgICAgICAgXCJmZWVfdmFsdWVcIjogYm9keS5mZWVfdmFsdWUsXHJcbiAgICAgICAgXCJ5ZWFyc19sYXN0X2pvYlwiOiBib2R5LnllYXJzX2xhc3Rfam9iLFxyXG4gICAgICAgIFwiZGF0ZV9sYXN0X2pvYlwiOiBcIjIwMTItMTAtMTBcIlxyXG4gICAgfVxyXG59XHJcbmNvbnN0IGJ1aWxkUGF5bG9hZEVxdWlmYXggPSAoYm9keSkgPT57XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIFwiaWRlbnRpZmllclR5cGVcIjogXCJSVVRcIixcclxuICAgICAgICBcImlkZW50aWZpZXJWYWx1ZVwiOiBib2R5LnJ1dCxcclxuICAgICAgICBcImluY29tZVwiOiBib2R5LmluY29tZVxyXG5cclxuICAgIH1cclxufVxyXG5cclxuY29uc3QgZGVjaXNpb25FbmdpbmUgPSBhc3luYyAoZGVwZW5kZW5jaWVzLCBib2R5KT0+IHtcclxuICAgIGNvbnN0IHsgQ29yZVNldHRpbmdQZ01vZGVsIH0gPSBkZXBlbmRlbmNpZXMuY29tbW9uTW9kZWxzO1xyXG4gICAgY29uc3QgY29yZVNldHRpbmcgPSBhd2FpdCBDb3JlU2V0dGluZ1BnTW9kZWwuZmluZE9uZSh7XHJcbiAgICAgICAgd2hlcmU6IHsgdHlwZTogJ1BSRUVWQUxVQVRJT05fTUFYX1ZFSElDTEVfWUVBUlMnIH0sXHJcbiAgICB9KTtcclxuICAgIGlmICghY29yZVNldHRpbmcpIHRocm93IG5ldyBFcnJvcignQ29yZSBzZXR0aW5nIGZvciBQUkVFVkFMVUFUSU9OX01BWF9WRUhJQ0xFX1lFQVJTIG5vdCBmb3VuZCcpO1xyXG4gICAgY29uc3QgeyB5ZWFycyB9ID0gY29yZVNldHRpbmcuc2V0dGluZztcclxuXHJcbiAgICBjb25zdCBwYXlsb2FkRXF1aWZheCA9IGJ1aWxkUGF5bG9hZEVxdWlmYXgoYm9keSk7XHJcbiAgICBjb25zdCBlcXVpZmF4ID0gYXdhaXQgZ2V0RXF1aWZheChkZXBlbmRlbmNpZXMsIHBheWxvYWRFcXVpZmF4KTtcclxuICAgIC8vdGllbmUgbW9yb3NpZGFkXHJcbiAgICBsZXQgc3RhdHVzID0gXCJSRUNIQVpBRE9cIjtcclxuICAgIGNvbnN0IGN1cnJlbnREYXRlID0gbW9tZW50KCk7XHJcbiAgICBjb25zdCBkYXRlQ2FyID0gbW9tZW50KCBib2R5LmNhcl95ZWFyIHx8ICcwMDAxLTAxLTAxJywgJ1lZWVlNTUREJyk7XHJcbiAgICB2YXIgZGlmZiA9IGN1cnJlbnREYXRlLmRpZmYoZGF0ZUNhciwgJ3llYXJzJyk7XHJcbiAgICBpZihkaWZmIDw9IHllYXJzKXtcclxuICAgICAgICByZXR1cm4gKHtzdGF0dXN9KTtcclxuICAgIH1cclxuICAgIGlmKGVxdWlmYXgucmVzdWx0LmdldERlbGlucXVlbmN5KXtcclxuXHJcbiAgICAgICAgY29uc3QgcGF5bG9hZFdpYyA9IGJ1aWxkUGF5bG9hZFdpYyhib2R5KTtcclxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBnZXRXaWMoZGVwZW5kZW5jaWVzLCBwYXlsb2FkV2ljKTtcclxuICAgICAgICBpZihyZXN1bHQgPT0gXCJBUFJPQkFET1wiKVxyXG4gICAgICAgICAgICBzdGF0dXMgPSBcIkFQUk9CQURPXCI7XHJcbiAgICAgICAgcmV0dXJuICh7c3RhdHVzfSk7XHJcbiAgICB9ZWxzZXtcclxuICAgICAgICByZXR1cm4gKHtyZXN1bHQ6J1JFQ0hBWkFETyd9KTtcclxuICAgIH1cclxuXHJcbiAgICBcclxufVxyXG5tb2R1bGUuZXhwb3J0cyA9IHtcclxuICAgIGRlY2lzaW9uRW5naW5lXHJcbn0iXX0=