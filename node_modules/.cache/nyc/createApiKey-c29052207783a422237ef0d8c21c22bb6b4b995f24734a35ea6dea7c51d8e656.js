function cov_10iaq6ezyi(){var path="/vagrant/continuum/core/src/modules/auth/middlewares/default/createApiKey.js";var hash="a87507a525d3e92999600bf0a5c692f8fd7a0950";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/vagrant/continuum/core/src/modules/auth/middlewares/default/createApiKey.js",statementMap:{"0":{start:{line:1,column:26},end:{line:1,column:58}},"1":{start:{line:3,column:21},end:{line:21,column:1}},"2":{start:{line:3,column:46},end:{line:21,column:1}},"3":{start:{line:4,column:33},end:{line:4,column:41}},"4":{start:{line:6,column:27},end:{line:6,column:39}},"5":{start:{line:7,column:26},end:{line:7,column:38}},"6":{start:{line:8,column:19},end:{line:8,column:68}},"7":{start:{line:9,column:30},end:{line:15,column:4}},"8":{start:{line:16,column:2},end:{line:18,column:3}},"9":{start:{line:17,column:4},end:{line:17,column:77}},"10":{start:{line:19,column:24},end:{line:19,column:32}},"11":{start:{line:20,column:2},end:{line:20,column:61}},"12":{start:{line:23,column:0},end:{line:23,column:34}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:3,column:21},end:{line:3,column:22}},loc:{start:{line:3,column:46},end:{line:21,column:1}},line:3},"1":{name:"(anonymous_1)",decl:{start:{line:3,column:46},end:{line:3,column:47}},loc:{start:{line:3,column:72},end:{line:21,column:1}},line:3}},branchMap:{"0":{loc:{start:{line:16,column:2},end:{line:18,column:3}},type:"if",locations:[{start:{line:16,column:2},end:{line:18,column:3}},{start:{line:16,column:2},end:{line:18,column:3}}],line:16}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0},f:{"0":0,"1":0},b:{"0":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"a87507a525d3e92999600bf0a5c692f8fd7a0950"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_10iaq6ezyi=function(){return actualCoverage;};}return actualCoverage;}cov_10iaq6ezyi();const{generateToken}=(cov_10iaq6ezyi().s[0]++,require('common/helpers/bcrypt'));cov_10iaq6ezyi().s[1]++;const createApiKey=(dependencies,stage)=>{cov_10iaq6ezyi().f[0]++;cov_10iaq6ezyi().s[2]++;return async(req,res,next)=>{cov_10iaq6ezyi().f[1]++;const{username,password}=(cov_10iaq6ezyi().s[3]++,req.body);const{commonModels}=(cov_10iaq6ezyi().s[4]++,dependencies);const{UserPgModel}=(cov_10iaq6ezyi().s[5]++,commonModels);const prepData=(cov_10iaq6ezyi().s[6]++,{username,password,apiKey:generateToken(64)});const[UserData,created]=(cov_10iaq6ezyi().s[7]++,await UserPgModel.findOrCreate({where:{username,password},defaults:prepData}));cov_10iaq6ezyi().s[8]++;if(!created){cov_10iaq6ezyi().b[0][0]++;cov_10iaq6ezyi().s[9]++;UserPgModel.update({apiKey:prepData.apiKey},{where:{username}});}else{cov_10iaq6ezyi().b[0][1]++;}const{createdAt}=(cov_10iaq6ezyi().s[10]++,UserData);cov_10iaq6ezyi().s[11]++;res.json({username,apiKey:prepData.apiKey,createdAt});};};cov_10iaq6ezyi().s[12]++;module.exports={createApiKey};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNyZWF0ZUFwaUtleS5qcyJdLCJuYW1lcyI6WyJnZW5lcmF0ZVRva2VuIiwicmVxdWlyZSIsImNyZWF0ZUFwaUtleSIsImRlcGVuZGVuY2llcyIsInN0YWdlIiwicmVxIiwicmVzIiwibmV4dCIsInVzZXJuYW1lIiwicGFzc3dvcmQiLCJib2R5IiwiY29tbW9uTW9kZWxzIiwiVXNlclBnTW9kZWwiLCJwcmVwRGF0YSIsImFwaUtleSIsIlVzZXJEYXRhIiwiY3JlYXRlZCIsImZpbmRPckNyZWF0ZSIsIndoZXJlIiwiZGVmYXVsdHMiLCJ1cGRhdGUiLCJjcmVhdGVkQXQiLCJqc29uIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IjI0REFlWTsyRkFmWixLQUFNLENBQUVBLGFBQUYsMkJBQW9CQyxPQUFPLENBQUMsdUJBQUQsQ0FBM0IsQ0FBTixDLHdCQUVBLEtBQU1DLENBQUFBLFlBQVksQ0FBRyxDQUFDQyxZQUFELENBQWVDLEtBQWYsR0FBeUIsOERBQU9DLEdBQVAsQ0FBWUMsR0FBWixDQUFpQkMsSUFBakIsR0FBMEIseUJBQ3RFLEtBQU0sQ0FBRUMsUUFBRixDQUFZQyxRQUFaLDJCQUF5QkosR0FBRyxDQUFDSyxJQUE3QixDQUFOLENBRUEsS0FBTSxDQUFFQyxZQUFGLDJCQUFtQlIsWUFBbkIsQ0FBTixDQUNBLEtBQU0sQ0FBRVMsV0FBRiwyQkFBa0JELFlBQWxCLENBQU4sQ0FDQSxLQUFNRSxDQUFBQSxRQUFRLDBCQUFHLENBQUVMLFFBQUYsQ0FBWUMsUUFBWixDQUFzQkssTUFBTSxDQUFFZCxhQUFhLENBQUMsRUFBRCxDQUEzQyxDQUFILENBQWQsQ0FDQSxLQUFNLENBQUNlLFFBQUQsQ0FBV0MsT0FBWCwyQkFBc0IsS0FBTUosQ0FBQUEsV0FBVyxDQUFDSyxZQUFaLENBQXlCLENBQ3pEQyxLQUFLLENBQUUsQ0FDTFYsUUFESyxDQUVMQyxRQUZLLENBRGtELENBS3pEVSxRQUFRLENBQUVOLFFBTCtDLENBQXpCLENBQTVCLENBQU4sQ0FOc0Usd0JBYXRFLEdBQUksQ0FBQ0csT0FBTCxDQUFjLG9EQUNaSixXQUFXLENBQUNRLE1BQVosQ0FBbUIsQ0FBRU4sTUFBTSxDQUFFRCxRQUFRLENBQUNDLE1BQW5CLENBQW5CLENBQWdELENBQUVJLEtBQUssQ0FBRSxDQUFFVixRQUFGLENBQVQsQ0FBaEQsRUFDRCxDQUZELGlDQUdBLEtBQU0sQ0FBRWEsU0FBRiw0QkFBZ0JOLFFBQWhCLENBQU4sQ0FoQnNFLHlCQWlCdEVULEdBQUcsQ0FBQ2dCLElBQUosQ0FBUyxDQUFFZCxRQUFGLENBQVlNLE1BQU0sQ0FBRUQsUUFBUSxDQUFDQyxNQUE3QixDQUFxQ08sU0FBckMsQ0FBVCxFQUNELENBbEI2QyxDQWtCN0MsQ0FsQkQsQyx5QkFvQkFFLE1BQU0sQ0FBQ0MsT0FBUCxDQUFpQixDQUFFdEIsWUFBRixDQUFqQiIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHsgZ2VuZXJhdGVUb2tlbiB9ID0gcmVxdWlyZSgnY29tbW9uL2hlbHBlcnMvYmNyeXB0Jyk7XHJcblxyXG5jb25zdCBjcmVhdGVBcGlLZXkgPSAoZGVwZW5kZW5jaWVzLCBzdGFnZSkgPT4gYXN5bmMgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XHJcbiAgY29uc3QgeyB1c2VybmFtZSwgcGFzc3dvcmQgfSA9IHJlcS5ib2R5O1xyXG5cclxuICBjb25zdCB7IGNvbW1vbk1vZGVscyB9ID0gZGVwZW5kZW5jaWVzO1xyXG4gIGNvbnN0IHsgVXNlclBnTW9kZWwgfSA9IGNvbW1vbk1vZGVscztcclxuICBjb25zdCBwcmVwRGF0YSA9IHsgdXNlcm5hbWUsIHBhc3N3b3JkLCBhcGlLZXk6IGdlbmVyYXRlVG9rZW4oNjQpIH07XHJcbiAgY29uc3QgW1VzZXJEYXRhLCBjcmVhdGVkXSA9IGF3YWl0IFVzZXJQZ01vZGVsLmZpbmRPckNyZWF0ZSh7XHJcbiAgICB3aGVyZToge1xyXG4gICAgICB1c2VybmFtZSxcclxuICAgICAgcGFzc3dvcmQsXHJcbiAgICB9LFxyXG4gICAgZGVmYXVsdHM6IHByZXBEYXRhLFxyXG4gIH0pO1xyXG4gIGlmICghY3JlYXRlZCkge1xyXG4gICAgVXNlclBnTW9kZWwudXBkYXRlKHsgYXBpS2V5OiBwcmVwRGF0YS5hcGlLZXkgfSwgeyB3aGVyZTogeyB1c2VybmFtZSB9IH0pO1xyXG4gIH1cclxuICBjb25zdCB7IGNyZWF0ZWRBdCB9ID0gVXNlckRhdGE7XHJcbiAgcmVzLmpzb24oeyB1c2VybmFtZSwgYXBpS2V5OiBwcmVwRGF0YS5hcGlLZXksIGNyZWF0ZWRBdCB9KTtcclxufTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0geyBjcmVhdGVBcGlLZXkgfTtcclxuIl19